(function(){"use strict";var e={7384:function(e,t,s){var i=s(5471),r=s(5668),o=s(4311),n=s(5322),a=function(){var e=this,t=e._self._c;return t(r.A,[t(o.A,{attrs:{app:"",color:"primary",dark:""}}),t(n.A,["StartForm"===e.page?t("StartForm",{on:{next:function(t){e.page="ResourceList"}}}):e._e(),"ResourceList"===e.page?t("ResourceList"):e._e()],1)],1)},u=[],l=s(2221),c=s(174),d=s(2386),h=function(){var e=this,t=e._self._c;return t("div",[e.loaded?e._e():t("FullscreenLoader"),t(c.A,{ref:"form"},[t(d.A,{attrs:{label:"Nome",required:"",rules:[e.rules.required]},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),t(d.A,{attrs:{label:"CPF",required:"",rules:[e.rules.required]},model:{value:e.identification,callback:function(t){e.identification=t},expression:"identification"}}),t(d.A,{attrs:{label:"Email",required:"",rules:[e.rules.required]},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),t(l.A,{on:{click:e.saveUser}},[e._v("Enviar")])],1)},f=[],p=s(1303),m=s(1554),v=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fullscreen-loader"},[t(m.A,{attrs:{indeterminate:"",size:"64",color:"primary"}})],1)},g=[],y={},_=y,b=s(1656),A=(0,b.A)(_,v,g,!1,null,"160064d0",null),k=A.exports,S={name:"StartForm",components:{FullscreenLoader:k},data:function(){return{name:null,identification:null,email:null,uuid:null,loaded:!1,rules:{required:e=>!!e||"Obrigatório"}}},mounted:function(){this.load()},methods:{load:async function(){if(this.uuid=localStorage.getItem("uuid_usuario"),this.uuid){let e;try{e=await this.$axios.get("/user?uuid_usuario="+this.uuid)}catch(t){return console.error(t),void this.$toasted.error("Não foi possível consultar o servidor")}if(e.data?.user)return void this.$emit("next")}const e=(0,p.A)();localStorage.setItem("uuid_usuario",e),this.uuid=e,this.loaded=!0},saveUser:async function(){if(this.$refs.form.validate()){this.loaded=!1;try{await this.$axios.post("/user",{uuid_usuario:this.uuid,numero_identificacao:this.identification,tipo_identificacao:"CPF",email:this.email,nome:this.name}),this.$toasted.success("Dados salvos com sucesso!")}catch(e){this.$toasted.error("Ocorreu um erro inesperado!")}finally{this.loaded=!0}this.$emit("next")}}}},w=S,x=(0,b.A)(w,h,f,!1,null,null,null),R=x.exports,P=s(9030),$=s(4730),O=s(2498),F=function(){var e=this,t=e._self._c;return t("div",[t("h1",[e._v(e._s(e.getTitle))]),e.phase===e.phases.waiting?t($.A,{attrs:{indeterminate:"",rounded:""}}):e._e(),e.phase===e.phases.picking?[t(O.A,[t("tbody",e._l(e.chunkedResources,(function(s,i){return t("tr",{key:i,staticStyle:{"border-bottom":"none"}},e._l(s,(function(s){return t("td",{key:s.id_recurso,staticStyle:{"border-bottom":"none"}},[t(P.A,{attrs:{label:s.label,value:s.id_recurso,disabled:1!==s.id_status_recurso&&!s.solicitado_por_mim,"hide-details":""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)})),0)})),0)]),t(l.A,{attrs:{disabled:!e.getMySelectedResourceIds.length},on:{click:e.requestResources}},[e._v("Solicitar mesas")])]:e._e()],2)},q=[],j=(s(4114),s(8111),s(2489),s(116),s(1701),{name:"ResourceList",data:function(){return{interval:null,phase:null,phases:{waiting:"waiting",picking:"picking",payment:"payment",finalized:"finalized"},uuid:null,resources:[],unavailableResources:[],selected:[]}},mounted:function(){this.phase=this.phases.waiting,this.uuid=localStorage.getItem("uuid_usuario"),this.startPolling()},computed:{getTitle:function(){return this.phase===this.phases.waiting?"Aguarde, você está na fila":this.phase===this.phases.picking?"Hora de escolher suas mesas":this.phase===this.phases.payment?"Pagamento":this.phase===this.phases.finalized?"Resumo da reserva":null},chunkedResources(){const e=4,t=[];for(let s=0;s<this.resources.length;s+=e)t.push(this.resources.slice(s,s+e));return t},getMySelectedResourceIds(){return this.selected.filter((e=>{const t=this.resources.find((t=>t.id_recurso===e));return 1===t.id_status_recurso||1===t.solicitado_por_mim}))}},methods:{startPolling:function(){this.interval||(this.getState(),this.interval=window.setInterval(this.getState,5e3))},getState:async function(){let e;try{e=await this.$axios.get("/state")}catch(s){return console.error(s),void this.$toasted.error("Não foi possível consultar a fila")}const t=e.data.usuario;1===t.minha_vez&&this.phase===this.phases.waiting?this.startPickingPhase():t.data_hora_fim_selecao&&this.phase!==this.phases.finalized&&this.gotoFinalized()},getResources:async function(){let e;try{e=await this.$axios.get("/resource")}catch(t){return console.error(t),void this.$toasted.error("Não foi possível consultar os recursos")}this.resources=e.data.recursos,this.selected=this.resources.filter((e=>1!==e.id_status_recurso)).map((e=>e.id_recurso))},startPickingPhase:function(){this.phase=this.phases.picking,this.getResources()},requestResources:async function(){if(this.getMySelectedResourceIds){try{await this.$axios.post("/resource/request",{resource_ids:this.getMySelectedResourceIds})}catch(e){return console.error(e),void this.$toasted.error("Não foi possível solicitar os recursos")}this.startPaymentPhase()}else this.$toasted.error("É necessário escolher ao menos uma mesa")},startPaymentPhase:function(){this.phase!==this.phases.payment&&(this.phase=this.phases.payment)},gotoFinalized:function(){this.phase=this.phases.finalized}}}),z=j,I=(0,b.A)(z,F,q,!1,null,null,null),L=I.exports,T={name:"App",components:{StartForm:R,ResourceList:L},data:()=>({page:"StartForm"})},M=T,C=(0,b.A)(M,a,u,!1,null,null,null),N=C.exports,U=s(5868);i.Ay.use(U.A);var E=new U.A({}),D=s(5160),H=s.n(D),X=s(4335);const B=X.A.create({baseURL:"https://03e2-2804-14c-8181-82ba-d0a-200f-9835-e021.ngrok-free.app",timeout:1e4,headers:{"Content-Type":"application/json"}});B.interceptors.request.use((e=>(e.headers["X-User-Uuid"]=localStorage.getItem("uuid_usuario"),e)));var G=B;i.Ay.config.productionTip=!1,i.Ay.prototype.$axios=G,i.Ay.use(H(),{position:"bottom-center",duration:3e3,theme:"toasted-primary"}),new i.Ay({vuetify:E,render:e=>e(N)}).$mount("#app")}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,i,r,o){if(!i){var n=1/0;for(c=0;c<e.length;c++){i=e[c][0],r=e[c][1],o=e[c][2];for(var a=!0,u=0;u<i.length;u++)(!1&o||n>=o)&&Object.keys(s.O).every((function(e){return s.O[e](i[u])}))?i.splice(u--,1):(a=!1,o<n&&(n=o));if(a){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,r,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,o,n=i[0],a=i[1],u=i[2],l=0;if(n.some((function(t){return 0!==e[t]}))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(u)var c=u(s)}for(t&&t(i);l<n.length;l++)o=n[l],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(c)},i=self["webpackChunklemefest"]=self["webpackChunklemefest"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(7384)}));i=s.O(i)})();
//# sourceMappingURL=app.86fbe0df.js.map