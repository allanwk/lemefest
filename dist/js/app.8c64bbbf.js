(function(){"use strict";var e={4496:function(e,t,i){e.exports=i.p+"img/colegio.5e9df97c.png"},7818:function(e,t,i){var a=i(5471),s=i(5668),o=i(301),n=i(5420),r=i(5322),l=i(1034),c=i(2367),d=function(){var e=this,t=e._self._c;return t(s.A,[t(o.A,{attrs:{app:"",color:"primary",dark:""}},[t(c.sw,[e._v("Festa Junina Leme 2025")]),t(l.A),t(n.A,{attrs:{src:i(4496),contain:"",height:"40","max-width":"40"}})],1),t(r.A,{staticClass:"background"},[e.step===e.steps.START_WAITING?t("StartWaiting",{on:{next:function(t){e.step=e.steps.REGISTER}}}):e._e(),e.step===e.steps.REGISTER?t("StartForm",{attrs:{fromRestart:e.restart},on:{gotoStep:e.handleGotoStep,next:function(t){e.step=e.steps.QUEUE}}}):e._e(),[e.steps.QUEUE,e.steps.SELECTION].includes(e.step)?t("ResourceList",{on:{next:function(t){e.step=e.steps.PAYMENT},timeExpired:function(t){e.step=e.steps.SELECTION_EXPIRED}}}):e._e(),e.step===e.steps.PAYMENT?t("PaymentStep",{on:{next:function(t){e.step=e.steps.PAID},timeExpired:function(t){e.step=e.steps.PAYMENT_EXPIRED}}}):e._e(),e.step===e.steps.PAID?t("PurchaseFinished",{on:{restart:e.handleRestart}}):e._e(),[e.steps.PAYMENT_EXPIRED,e.steps.SELECTION_EXPIRED].includes(e.step)?t("TimeExpired",{attrs:{step:e.step},on:{restart:e.handleRestart}}):e._e()],1)],1)},u=[],m=(i(8111),i(116),i(1484)),h=i(2938),p=i(3449),f=function(){var e=this,t=e._self._c;return t(p.A,{attrs:{fluid:"","fill-height":""}},[e.loaded?null!=e.remainingSeconds?t("CountdownTimer",{ref:"timer",attrs:{"initial-time":e.remainingSeconds,message:"O cadastro para seleção das mesas começará em:"},on:{timerEnd:e.waitThenCheckIfStarted}}):e._e():t("FullscreenLoader"),e.unavailable?t(m.A,[t(h.ri,{staticClass:"keep-words"},[e._v("Parece que o sistema ainda não está disponível, tente novamente mais tarde.")])],1):e._e()],1)},g=[],v=i(1554),_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fullscreen-loader"},[t(v.A,{attrs:{indeterminate:"",size:"64",color:"primary"}})],1)},S=[],y={},A=y,b=i(1656),E=(0,b.A)(A,_,S,!1,null,"160064d0",null),T=E.exports,C=i(5835),k=function(){var e=this,t=e._self._c;return t(m.A,{staticClass:"countdown-timer py-0",attrs:{outlined:""}},[t(h.OQ,{staticClass:"text-center py-0"},[e._v(" "+e._s(e.message)+" "),t("div",{staticClass:"time-display text-h5 font-weight-bold"},[e._v(" "+e._s(e.formattedMinutes)+":"+e._s(e.formattedSeconds)+" ")]),e.showControls?t(h.SL,{staticClass:"justify-center"},[t(C.A,{attrs:{color:"primary",disabled:e.remainingTime<=0},on:{click:e.toggleTimer}},[e._v(" "+e._s(e.isRunning?"Pause":"Start")+" ")]),t(C.A,{attrs:{color:"secondary",disabled:e.remainingTime===e.initialTime},on:{click:e.resetTimer}},[e._v(" Reset ")])],1):e._e()],1)],1)},x=[],I={name:"CountdownTimer",props:{initialTime:{type:Number,required:!0,validator:e=>e>=0},showControls:{type:Boolean,default:!1},autoStart:{type:Boolean,default:!1},message:{type:String}},data(){return{remainingTime:this.initialTime,timer:null,isRunning:!1}},computed:{formattedMinutes(){const e=Math.floor(this.remainingTime/60);return e.toString().padStart(2,"0")},formattedSeconds(){const e=this.remainingTime%60;return e.toString().padStart(2,"0")},timeWarning(){return this.remainingTime<=10},timeCritical(){return this.remainingTime<=5}},watch:{initialTime(e){this.resetTimer(e)}},mounted(){this.autoStart&&this.startTimer()},beforeDestroy(){this.clearTimer()},methods:{startTimer(){this.clearTimer(),this.remainingTime>0&&(this.isRunning=!0,this.timer=setInterval((()=>{this.remainingTime-=1,this.remainingTime<=0&&(this.remainingTime=0,this.clearTimer(),this.$emit("timerEnd"))}),1e3))},pauseTimer(){this.clearTimer(),this.isRunning=!1},toggleTimer(){this.isRunning?this.pauseTimer():this.startTimer()},resetTimer(e=this.initialTime){this.pauseTimer(),this.remainingTime=e,this.$emit("timer-reset")},clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)},addTime(e){this.remainingTime+=e,!this.isRunning&&this.remainingTime>0&&this.startTimer()},setTime(e){this.resetTimer(e)}}},w=I,P=(0,b.A)(w,k,x,!1,null,"64c6abf5",null),R=P.exports,$={name:"StartWaiting",components:{FullscreenLoader:T,CountdownTimer:R},data:function(){return{loaded:!1,remainingSeconds:null,interval:null,retried:!1,unavailable:!1,timerEnded:!1}},mounted:async function(){await this.checkIfStarted()},methods:{checkIfStarted:async function(){try{const e=await this.$axios.post("/state/getStarted");null!=e.data.segundos_ate_liberacao&&(parseInt(e.data.segundos_ate_liberacao,10)<=0?this.$emit("next"):(this.loaded=!0,this.remainingSeconds=e.data.segundos_ate_liberacao,this.$nextTick((()=>{this.$refs.timer.startTimer()}))))}catch(e){console.log(e),!this.retried||this.timerEnded?(this.retried=!0,window.setTimeout(this.checkIfStarted,5e3)):(this.loaded=!0,this.unavailable=!0)}},waitThenCheckIfStarted:async function(){this.loaded=!1,this.timerEnded=!0;const e=Math.floor(501*Math.random());window.setTimeout(this.checkIfStarted,e)}}},D=$,N=(0,b.A)(D,f,g,!1,null,"6d81b3ec",null),L=N.exports,O=i(4414),q=i(2413),M=i(9483),V=i(174),F=i(2756),U=i(2494),j=function(){var e=this,t=e._self._c;return t(p.A,{staticClass:"d-flex align-center",staticStyle:{"justify-content":"space-around"},attrs:{"fill-height":"",fluid:""}},[e.loaded?e._e():t("FullscreenLoader"),t("div",{staticStyle:{width:"100%"}},[t(m.A,{staticClass:"mt-n10",staticStyle:{width:"100%"}},[t(h.ri,[e._v(" "+e._s(e.cardTitle)+" ")]),t(h.OQ,[t(V.A,{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[e.isStudentStep?[t("p",[e._v("Para cada aluno identificado, você poderá comprar até 2 mesas")]),t(F.A,{attrs:{align:"center",justify:"center"}},[t(O.A,[t(U.A,{directives:[{name:"mask",rawName:"v-mask",value:"###########",expression:"'###########'"}],attrs:{label:"RM do aluno",required:"",rules:e.validationEnabled?[e.rules.required]:[],clearable:"",inputmode:"numeric",pattern:"[0-9]*"},model:{value:e.studentCode,callback:function(t){e.studentCode=t},expression:"studentCode"}})],1),t(O.A,{attrs:{cols:"5"}},[t(C.A,{attrs:{color:"primary",outlined:"",loading:e.loadingAddStudent},on:{click:e.checkStudent}},[e._v("Adicionar")])],1)],1),t(M.A),t("p",{staticClass:"mt-4"},[e._v(e._s(e.informedStudentsText))])]:[t("p",[e._v("Por favor preencha corretamente. Precisamos desses dados para processar o pagamento via PIX.")]),t(U.A,{attrs:{label:"Nome Completo",required:"",rules:e.validationEnabled?[e.rules.required]:[],clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),t(U.A,{directives:[{name:"mask",rawName:"v-mask",value:"###.###.###-##",expression:"'###.###.###-##'"}],attrs:{label:"CPF",required:"",rules:e.validationEnabled?[e.rules.required,e.isValidCPF]:[],clearable:"",inputmode:"numeric",pattern:"[0-9]*"},model:{value:e.identification,callback:function(t){e.identification=t},expression:"identification"}}),t(U.A,{staticStyle:{"text-transform":"none"},attrs:{label:"Email",type:"email",required:"",rules:e.validationEnabled?[e.rules.required,e.rules.validEmail]:[],clearable:"",autocapitalize:"off"},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.handleSubmit.apply(null,arguments))}},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})]],2)],1),t(h.SL,[t(l.A),t(C.A,{attrs:{color:"accent"},on:{click:e.startClearAction}},[e._v("Limpar")]),e.isStudentStep?t(C.A,{attrs:{disabled:e.isStudentStep&&!e.students.length,loading:e.handleNextLoading,color:"primary"},on:{click:e.handleAction}},[e._v("Próximo")]):t(C.A,{attrs:{color:"primary"},on:{click:e.handleAction}},[e._v("Salvar")])],1)],1)],1),t(q.A,{model:{value:e.dataConfirmationDialog,callback:function(t){e.dataConfirmationDialog=t},expression:"dataConfirmationDialog"}},[t(m.A,[t(h.ri,[e._v("Os dados estão corretos?")]),t(h.OQ,[t("p",[e._v("Nome: "+e._s(e.name))]),t("p",[e._v("CPF: "+e._s(e.identification))]),t("p",[e._v("E-mail: "+e._s(e.email))]),t("b",[e._v("Verifique com cuidado, você não poderá alterá-los depois!")])]),t(h.SL,[t(l.A),t(C.A,{attrs:{outline:"",color:"accent"},on:{click:function(t){e.dataConfirmationDialog=!1}}},[e._v("Voltar")]),t(C.A,{attrs:{color:"primary"},on:{click:e.confirmBasicData}},[e._v("Confirmar")])],1)],1)],1),t(q.A,{model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(m.A,[t(h.ri,[e._v(" Aluno encontrado ")]),t(h.OQ,[e._v(' Encontramos o aluno "'+e._s(e.foundStudentName)+'". Confirma a adição? ')]),t(h.SL,[t(l.A),t(C.A,{attrs:{outline:"",color:"accent"},on:{click:e.closeStudentDialog}},[e._v("Voltar")]),t(C.A,{attrs:{color:"primary"},on:{click:e.confirmStudent}},[e._v("Confirmar")])],1)],1)],1),t(q.A,{model:{value:e.confirmationDialog,callback:function(t){e.confirmationDialog=t},expression:"confirmationDialog"}},[t(m.A,[t(h.ri,[e._v("Confirmação")]),t(h.OQ,[t("p",[e._v(e._s(e.informedStudentsText)+" Portanto você poderá escolher até "),t("b",{staticStyle:{color:"#000084"}},[e._v(e._s(e.maxTables)+" mesas")]),e._v(" (considerando também mesas que já tenha comprado em passos anteriores).")]),t("p",[e._v("Aviso: após confirmar, não será possível voltar.")])]),t(h.SL,[t(l.A),t(C.A,{attrs:{outline:"",color:"accent"},on:{click:function(t){e.confirmationDialog=!1}}},[e._v("Voltar")]),t(C.A,{attrs:{color:"primary"},on:{click:e.enterQueue}},[e._v("Confirmar")])],1)],1)],1),t(q.A,{model:{value:e.clearConfirmationDialog,callback:function(t){e.clearConfirmationDialog=t},expression:"clearConfirmationDialog"}},[t(m.A,[t(h.ri,[e._v("Confirmação")]),t(h.OQ,[e.isStudentStep?t("p",[e._v("Remover alunos selecionados?")]):t("p",[e._v("Limpar campos preenchidos?")])]),t(h.SL,[t(l.A),t(C.A,{attrs:{outline:"",color:"accent"},on:{click:function(t){e.clearConfirmationDialog=!1}}},[e._v("Voltar")]),t(C.A,{attrs:{color:"primary"},on:{click:e.clear}},[e._v("Sim")])],1)],1)],1),t(q.A,{model:{value:e.errorDialog,callback:function(t){e.errorDialog=t},expression:"errorDialog"}},[t(m.A,[t(h.ri,{staticClass:"keep-words"},[e._v(e._s(e.errorDialogMessage))]),t(h.SL,[t(l.A),t(C.A,{attrs:{outline:"",color:"primary"},on:{click:function(t){e.errorDialog=!1}}},[e._v("OK")])],1)],1)],1)],1)},Q=[],B=(i(4114),i(1701),i(1303)),Y={name:"StartForm",components:{FullscreenLoader:T},props:{fromRestart:{type:Boolean,default:!1}},data:function(){return{name:null,identification:null,email:null,uuid:null,loaded:!1,validationEnabled:!1,isStudentStep:!1,students:[],studentCode:null,foundStudentName:null,foundStudentId:null,foundStudentCode:null,dialog:!1,confirmationDialog:!1,clearConfirmationDialog:!1,dataConfirmationDialog:!1,loadingAddStudent:!1,handleNextLoading:!1,errorDialog:!1,errorDialogMessage:null,rules:{required:e=>!!e&&e.trim().length>=3||"Digite ao menos 3 caracteres",validEmail:e=>!!e&&/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(e.trim())||"E-mail inválido"}}},mounted:function(){this.load()},computed:{cardTitle:function(){return this.isStudentStep?"Informar Aluno(s)":"Dados para pagamento"},informedStudentsText:function(){return this.students.length?1===this.students.length?"Você informou o RM do aluno "+this.students.map((e=>`"${e.name}"`)).join(", ")+".":"Você informou o RM dos alunos "+this.students.map((e=>`"${e.name}"`)).join(", ")+".":"Identifique ao menos um aluno para continuar."},maxTables:function(){return 2*this.students.length}},methods:{load:async function(){if(this.fromRestart){try{await this.loadLinkedStudents(),this.isStudentStep=!0,this.loaded=!0}catch(t){console.error(t),this.$toasted.error("Erro ao consultar os alunos.")}return}if(this.uuid=localStorage.getItem("uuid_usuario"),this.uuid){let e;try{e=await this.$axios.post("/user/get",{uuid_usuario:this.uuid})}catch(t){return console.error(t),void this.$toasted.error("Não foi possível consultar o servidor")}if(e.data?.user?.id_etapa)return void this.$emit("gotoStep",e.data?.user?.id_etapa);if(e.data?.user)return this.isStudentStep=!0,void(this.loaded=!0)}const e=(0,B.A)();localStorage.setItem("uuid_usuario",e),this.uuid=e,this.loaded=!0},handleSubmit:function(){console.log("handleSubmit"),this.isStudentStep?(this.validationEnabled=!0,this.$nextTick((async()=>{this.$refs.form.validate()&&this.checkStudent()}))):this.handleAction()},handleAction:function(){this.isStudentStep?this.checkIfCanBuyMoreResources():(this.validationEnabled=!0,this.$nextTick((async()=>{this.$refs.form.validate()&&(this.dataConfirmationDialog=!0)})))},registerUser:async function(){this.loaded=!1;try{const e=await this.$axios.post("/user/create",{uuid_usuario:this.uuid,numero_identificacao:this.identification.trim(),tipo_identificacao:"CPF",email:this.email.trim(),nome:this.name.trim()}),t=e.data.token;localStorage.setItem("token",t),this.$toasted.success("Usuário cadastrado"),this.isStudentStep=!0,this.$refs.form&&this.$refs.form.resetValidation(),this.validationEnabled=!1}catch(e){return void(null!=e.response?.data?.message?this.$toasted.error(e.response.data.message):this.$toasted.error("Ocorreu um erro inesperado!"))}finally{this.loaded=!0}},enterQueue:async function(){this.loaded=!1;try{await this.$axios.post("/user/enter-queue",{codigos_alunos:this.students.map((e=>e.studentCode))})}catch(e){return void(null!=e.response?.data?.message?this.$toasted.error(e.response.data.message):this.$toasted.error("Ocorreu um erro inesperado!"))}finally{this.loaded=!0}this.$emit("next")},back:function(){this.isStudentStep=!1},clear:function(){this.isStudentStep?(this.students=[],this.studentCode=null,this.clearConfirmationDialog=!1):(this.identification=null,this.email=null,this.name=null,this.$refs.form.resetValidation(),this.validationEnabled=!1,this.clearConfirmationDialog=!1)},isValidCPF:function(e){if(null==e)return"CPF inválido";const t=e.replace(/[^\d]+/g,"");if(11!==t.length||/^(\d)\1+$/.test(t))return"CPF inválido";let i=0;for(let s=0;s<9;s++)i+=parseInt(t.charAt(s))*(10-s);let a=10*i%11;if(10!==a&&11!==a||(a=0),a!==parseInt(t.charAt(9)))return"CPF inválido";i=0;for(let s=0;s<10;s++)i+=parseInt(t.charAt(s))*(11-s);return a=10*i%11,10!==a&&11!==a||(a=0),a===parseInt(t.charAt(10))||"CPF inválido"},checkStudent:async function(){this.validationEnabled=!0,this.$nextTick((async()=>{if(!this.$refs.form.validate())return;if(this.students.find((e=>e.studentCode===this.studentCode.trim())))return void this.showError("Você já adicionou esse aluno.");let e;this.loadingAddStudent=!0;try{e=await this.$axios.post("/student/get",{codigo_aluno:this.studentCode.trim()})}catch(t){return 404===t.status?this.showError("Aluno não encontrado, por favor revise o código digitado."):400===t.status?this.showError("O aluno informado já está vinculado a outro usuário."):this.showError("Erro inesperado ao consultar aluno.")}finally{this.loadingAddStudent=!1}this.foundStudentName=e.data.aluno.nome,this.foundStudentId=e.data.aluno.id_aluno,this.foundStudentCode=e.data.aluno.codigo,this.dialog=!0}))},closeStudentDialog:function(){this.dialog=!1,this.$nextTick((()=>{this.foundStudentName=null,this.foundStudentCode=null}))},confirmStudent:function(){this.students.push({name:this.foundStudentName,studentId:this.foundStudentId,studentCode:this.foundStudentCode}),this.$nextTick((()=>{this.foundStudentId=null,this.studentCode=null,this.validationEnabled=!1,this.closeStudentDialog(),this.$toasted.success("Aluno adicionado!")}))},loadLinkedStudents:async function(){const e=await this.$axios.post("/student/linked");e.data?.alunos&&(this.students=e.data.alunos.map((e=>({name:e.nome,studentId:e.id_aluno,studentCode:e.codigo}))))},startClearAction:function(){if(this.fromRestart)return this.$toasted.error("Como você já comprou alguma mesa, não é possível remover os alunos identificados. Caso tenha adicionado um aluno incorretamente, por favor recarregue a página.");this.clearConfirmationDialog=!0},checkIfCanBuyMoreResources:async function(){this.handleNextLoading=!0;try{const e=await this.$axios.post("/resource/booked"),t=e.data?.recursos,i=2*this.students.length;if(null!=t&&t.length>=i)return this.$toasted.error("Você já comprou a quantidade máxima de mesas para o número de alunos identificados. Para comprar mais mesas, é necessário informar o código de mais alunos.");this.confirmationDialog=!0}catch(e){this.$toasted.error("Erro inesperado!")}finally{this.handleNextLoading=!1}},confirmBasicData:async function(){this.dataConfirmationDialog=!1,await this.registerUser()},showError:function(e){this.errorDialogMessage=e,this.$nextTick((()=>{this.errorDialog=!0}))}}},X=Y,z=(0,b.A)(X,j,Q,!1,null,null,null),G=z.exports,W=i(8143),K=i(6930),J=function(){var e=this,t=e._self._c;return t(p.A,{attrs:{fluid:"","fill-height":""}},[e.loaded?[t(m.A,{staticStyle:{width:"100%"}},[t(h.ri,{staticClass:"py-1"},[t(F.A,{attrs:{justify:"center",align:"center"}},[e.step===e.steps.SELECTION&&null!=e.remainingSeconds?t(O.A,[t("countdown-timer",{ref:"timer",attrs:{"initial-time":e.remainingSeconds,message:"Tempo para escolher: "},on:{timerEnd:e.atTimerEnd}})],1):t(O.A,{staticStyle:{"min-width":"170px",display:"flex","align-content":"center","justify-content":"center"}},[t("span",{staticClass:"mr-2 keep-words"},[e._v(e._s(e.getTitle))]),e.step===e.steps.QUEUE?t(v.A,{attrs:{indeterminate:"",color:"primary"}}):e._e()],1)],1)],1),t(h.OQ,[t("div",{staticClass:"table-map"},[t("div",{staticStyle:{"grid-area":"1 / 14 / span 1 / span 7",display:"grid","place-items":"center"}},[t("h1",[e._v("Cantina e bar")])]),t("div",{staticStyle:{"grid-area":"3 / 21 / span 9 / span 1",display:"grid","place-items":"center"}},[t("h1",{staticStyle:{"writing-mode":"vertical-rl"}},[e._v("Palco da quadra / caixa")])]),t("div",{staticClass:"border",staticStyle:{"grid-area":"2 / 1 / 12 / 21",margin:"-10px"}}),e._l(e.resources,(function(i){return t("NumberToggle",{key:i.id_recurso,style:e.getItemStyle(i),attrs:{value:i.id_recurso,number:parseInt(i.nome_recurso_short,10),state:e.getResourceState(i),readonly:e.step===e.steps.QUEUE},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})})),t("div",{staticClass:"palco border"},[t("div",{staticStyle:{"grid-area":"1 / 1 / span 4 / span 7",display:"grid","place-items":"center"}},[t("h1",[e._v("Apresentações")])]),t("div",{staticClass:"border",staticStyle:{"grid-area":"5 / 1 / span 1 / span 3",display:"grid","place-items":"center"}},[t("h2",[e._v("Fotos")])]),t("div",{staticClass:"border",staticStyle:{"grid-area":"5 / 5 / span 1 / span 3",display:"grid","place-items":"center"}},[t("h2",[e._v("Fotos")])])]),t("div",{staticStyle:{"grid-area":"12 / 1 / 12 / 7"}},[t("h1",{staticStyle:{"text-align":"left"}},[e._v("Entrada")]),t(K.A,{staticStyle:{transform:"scaleX(4) scaleY(1)","transform-origin":"left"}},[e._v("mdi-arrow-right-bold")])],1),t("div",{staticStyle:{"grid-area":"13 / 1 / 13 / 21",display:"grid","place-items":"center"}},[t("h1",{staticStyle:{"text-align":"left"}},[e._v("Arquibancada")])])],2)])],1),t(q.A,{model:{value:e.informationDialog,callback:function(t){e.informationDialog=t},expression:"informationDialog"}},[t(m.A,[t(h.ri,[e._v(" Seleção de mesas ")]),t(h.OQ,[t("ul",[t("li",[e._v("Para navegar pelo mapa, basta arrastar a tela")]),t("li",[e._v("Quando chegar a sua vez na fila, você poderá clicar nas mesas para escolhê-las")]),t("li",[e._v("Fique atento ao "),t("b",[e._v("tempo limite")]),e._v(" para escolher as mesas. Quando for sua vez, um contador aparecerá no topo da tela.")]),t("li",[e._v('Quando tiver escolhido suas mesas, basta clicar no botão "Comprar mesas" na parte inferior da tela')])])]),t(h.SL,[t(l.A),t(C.A,{attrs:{color:"primary"},on:{click:function(t){e.informationDialog=!1}}},[e._v("OK")])],1)],1)],1),t(W.A,{staticStyle:{"justify-content":"end",gap:"5px"},attrs:{color:"primary",app:""}},[e.step===e.steps.SELECTION?[t("span",{staticStyle:{color:"background"}},[e._v(e._s(e.totalPriceLabel))]),t(l.A),t(C.A,{attrs:{color:"background"},on:{click:function(t){e.informationDialog=!0}}},[e._v("Ajuda")]),t(C.A,{attrs:{color:"background",loading:e.buttonLoading},on:{click:e.requestPickedResources}},[e._v(e._s(e.buyButtonLabel))])]:t(C.A,{attrs:{color:"background"},on:{click:function(t){e.informationDialog=!0}}},[e._v("Ajuda")])],2)]:t("FullscreenLoader")],2)},H=[],Z=(i(2489),i(8237),function(){var e=this,t=e._self._c;return t("div",{staticClass:"numbered-checkbox",class:{checked:e.isChecked,"disabled-cursor":1===e.state,"disabled-light":2===e.state,"disabled-dark":3===e.state,"disabled-color":4===e.state},on:{click:e.toggle}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.internalValue,expression:"internalValue"}],staticClass:"hidden-checkbox",attrs:{type:"checkbox",disabled:e.disabled,readonly:e.readonly},domProps:{value:e.value,checked:Array.isArray(e.internalValue)?e._i(e.internalValue,e.value)>-1:e.internalValue},on:{change:[function(t){var i=e.internalValue,a=t.target,s=!!a.checked;if(Array.isArray(i)){var o=e.value,n=e._i(i,o);a.checked?n<0&&(e.internalValue=i.concat([o])):n>-1&&(e.internalValue=i.slice(0,n).concat(i.slice(n+1)))}else e.internalValue=s},e.handleChange]}}),t("span",{staticClass:"checkbox-number"},[e._v(e._s(e.number))])])}),ee=[],te={name:"NumberedCheckbox",model:{prop:"modelValue",event:"change"},props:{value:{type:[String,Number,Boolean,Object],required:!0},modelValue:{type:[Array,Boolean],default:()=>[]},number:{type:Number,required:!0},state:{type:Number,required:!0},readonly:{type:Boolean,default:!1}},computed:{internalValue:{get(){return this.modelValue},set(e){this.$emit("change",e)}},isChecked(){return Array.isArray(this.modelValue)?this.modelValue.includes(this.value):this.modelValue},disabled(){return this.state>0}},methods:{toggle(){if(!this.disabled)if(Array.isArray(this.modelValue)){const e=[...this.modelValue],t=e.indexOf(this.value);-1===t?e.push(this.value):e.splice(t,1),this.$emit("change",e)}else this.$emit("change",!this.modelValue)},handleChange(e){this.$emit("change",e.target.checked)}}},ie=te,ae=(0,b.A)(ie,Z,ee,!1,null,"39b03f1b",null),se=ae.exports,oe={name:"ResourceList",components:{NumberToggle:se,CountdownTimer:R,FullscreenLoader:T},data:function(){return{loaded:!1,interval:null,step:1,steps:{REGISTER:0,QUEUE:1,SELECTION:2,PAYMENT:3,PAID:4,SELECTION_EXPIRED:5},resources:[],unavailableResources:[],selected:[],qr_code:null,qr_code_base64:null,buttonLoading:!1,tableLimit:0,remainingSeconds:null,informationDialog:!0,shownAlert:!1,queuePosition:null,pollingInterval:6e4,pollingIntervals:{EVERY_MINUTE:6e4,EVERY_10_SECONDS:1e4,EVERY_5_SECONDS:5e3},timeout:null}},mounted:function(){this.startPolling()},beforeDestroy:function(){this.stopPollingState(),this.timeout&&window.clearTimeout(this.timeout)},computed:{getTitle:function(){return this.step===this.steps.QUEUE?this.queuePosition<=2?"Aguarde, você será o próximo a escolher.":null!=this.queuePosition?`Aguarde, você está em ${this.queuePosition}º lugar na fila.`:"Aguarde, você está na fila.":this.step===this.steps.SELECTION?"Tempo para escolher:":null},getMySelectedResourceIds(){return this.selected.filter((e=>{const t=this.resources.find((t=>t.id_recurso===e));return 1===t.id_status_recurso||4!==t.id_status_recurso&&1===t.solicitado_por_mim}))},getMyBookedResources(){return this.selected.filter((e=>{const t=this.resources.find((t=>t.id_recurso===e));return 4===t.id_status_recurso&&1===t.solicitado_por_mim}))},buyButtonLabel:function(){return 1===this.getMySelectedResourceIds.length?"Comprar mesa":this.getMySelectedResourceIds.length>1?`Comprar ${this.getMySelectedResourceIds.length} mesas`:"Comprar mesas"},totalPriceLabel:function(){const e=this.getMySelectedResourceIds.reduce(((e,t)=>e+Number(this.resources.find((e=>e.id_recurso===t)).valor)),0);return"Total: R$ "+e.toFixed(2)},resourceLimitReached:function(){return this.getMyBookedResources.length+this.getMySelectedResourceIds.length>=this.tableLimit}},methods:{startPolling:function(){this.interval||(this.getState(),this.interval=window.setInterval(this.getState,this.pollingInterval))},stopPollingState:function(){this.interval&&(window.clearInterval(this.interval),this.interval=null)},changePollingRate:function(e){this.pollingInterval=e,this.interval&&window.clearInterval(this.interval),this.interval=window.setInterval(this.getState,e)},getState:async function(){let e;try{e=await this.$axios.post("/state")}catch(i){return console.error(i),void this.$toasted.error("Não foi possível consultar a fila")}this.step!==this.steps.QUEUE&&this.resources.length||!e.data.recursos||(this.resources=e.data.recursos,this.selected=this.resources.filter((e=>1!==e.id_status_recurso)).map((e=>e.id_recurso)),this.loaded=!0);const t=e.data.usuario;return parseInt(t.segundos_restantes_selecao)<0?(this.stopPollingState(),void this.$emit("timeExpired")):(this.step===this.steps.QUEUE&&null!=t.posicao&&(this.queuePosition=parseInt(t.posicao,10),1===this.queuePosition?this.changePollingRate(this.pollingIntervals.EVERY_5_SECONDS):this.queuePosition<=2&&this.changePollingRate(this.pollingIntervals.EVERY_10_SECONDS)),1===t.minha_vez&&this.step===this.steps.QUEUE&&null!=t.limite_mesas?(this.startSelectionStep(),this.tableLimit=parseInt(t.limite_mesas,10),this.remainingSeconds=t.segundos_restantes_selecao,this.$nextTick((()=>{this.$refs.timer.startTimer()})),void this.$toasted.success("Chegou sua vez na fila! Por favor selecione suas mesas.",{position:"top-center"})):void(1===t.minha_vez&&this.step===this.steps.SELECTION&&(this.remainingSeconds=t.segundos_restantes_selecao,!this.shownAlert&&parseInt(this.remainingSeconds,10)<=60&&(this.$toasted.error('Atenção! Você tem menos de um minuto para terminar de selecionar suas mesas. Termine a seleção e clique em "Comprar mesas" dentro do tempo limite para garantir suas mesas.',{position:"top-center",duration:8e3}),this.shownAlert=!0),this.$nextTick((()=>{this.$refs.timer.startTimer()})))))},startSelectionStep:function(){this.step=this.steps.SELECTION,this.changePollingRate(this.pollingIntervals.EVERY_5_SECONDS)},requestPickedResources:async function(){if(!this.getMySelectedResourceIds.length)return void this.$toasted.error("É necessário escolher ao menos uma mesa",{position:"top-center"});let e;this.buttonLoading=!0;try{e=await this.$axios.post("/resource/request",{resource_ids:this.getMySelectedResourceIds})}catch(t){return console.error(t),void this.$toasted.error("Não foi possível solicitar os recursos",{position:"top-center"})}finally{this.buttonLoading=!1}this.stopPollingState(),this.$emit("next",e)},getResourceState:function(e){return 4===e.id_status_recurso&&e.solicitado_por_mim?4:1===e.id_status_recurso||e.solicitado_por_mim?this.step===this.steps.QUEUE?1:this.resourceLimitReached&&-1===this.selected.findIndex((t=>t===e.id_recurso))?2:0:3},getItemStyle:function(e){return null==e.row_start||null==e.row_end||null==e.column_start||null==e.column_end?null:{"grid-row":e.row_start+1+" / span "+(e.row_end-e.row_start+1),"grid-column":e.column_start+" / span "+(e.column_end-e.column_start+1)}},atTimerEnd:function(){this.stopPollingState(),this.timeout=window.setTimeout(this.getState,1e3)}}},ne=oe,re=(0,b.A)(ne,J,H,!1,null,"72925501",null),le=re.exports,ce=function(){var e=this,t=e._self._c;return t(p.A,{attrs:{fluid:"","fill-height":""}},[e.loaded?t(m.A,[t(h.ri,[t(F.A,{attrs:{justify:"center",align:"center"}},[null!=e.payment_value?t(O.A,{staticClass:"keep-words"},[e._v(" Pague R$"+e._s(e.payment_value.toFixed(2))+" via PIX ")]):e._e(),null!=e.remainingSeconds?t(O.A,[t("countdown-timer",{ref:"timer",attrs:{"initial-time":e.remainingSeconds,message:"Tempo restante"},on:{timerEnd:e.atTimerEnd}})],1):e._e()],1)],1),t(h.OQ,[t("div",{staticClass:"mb-2"},[e._v("Escaneie o código QR:")]),e.qr_code_base64?t(n.A,{attrs:{src:`data:image/png;base64,${e.qr_code_base64}`}}):e._e(),t(M.A,{staticClass:"mb-1"}),t("div",{staticClass:"mb-2"},[e._v("Ou use o código abaixo:")]),t(U.A,{attrs:{id:"textToCopy",readonly:"",value:e.qr_code,"append-icon":"mdi-content-copy"},on:{"click:append":e.copyCode}}),t(F.A,{attrs:{align:"center",justify:"center"}},[t(O.A,{staticStyle:{display:"grid","place-items":"center"},attrs:{cols:"12"}},[t(C.A,{attrs:{color:"primary"},on:{click:e.copyCode}},[e._v("Copiar código")])],1)],1),t(F.A,[t(O.A,[t("p",[e._v("Você será redirecionado automaticamente assim que o pagamento for aprovado.")])])],1)],1)],1):t("FullscreenLoader")],1)},de=[],ue={name:"PaymentStep",components:{CountdownTimer:R,FullscreenLoader:T},data:function(){return{qr_code:null,qr_code_base64:null,payment_value:null,interval:null,remainingSeconds:null,shownAlert:!1,loaded:!1,timeout:null}},mounted:function(){this.loadPayment(),this.startPolling()},beforeDestroy:function(){this.stopPolling(),this.timeout&&window.clearTimeout(this.timeout)},methods:{loadPayment:async function(){try{const e=await this.$axios.post("/payment");if(e.data.pagamento){const{qr_code:t,qr_code_base64:i,valor:a}=e.data.pagamento;this.qr_code=t,this.qr_code_base64=i,this.payment_value=Number(a),this.loaded=!0}}catch(e){this.$toasted.error("Erro ao carregar pagamento. Por favor recarregue a página em instantes")}},startPolling:function(){this.interval||(this.getState(),this.interval=window.setInterval(this.getState,5e3))},stopPolling:function(){this.interval&&(window.clearInterval(this.interval),this.interval=null)},getState:async function(){let e;try{e=await this.$axios.post("/state")}catch(i){return console.error(i),void this.$toasted.error("Não foi possível consultar a fila")}const t=e.data.usuario;return 4===t.id_etapa?(this.stopPolling(),void this.$emit("next")):parseInt(t.segundos_restantes_pagamento,10)<0?(this.stopPolling(),void this.$emit("timeExpired")):(this.remainingSeconds=t.segundos_restantes_pagamento,!this.shownAlert&&parseInt(this.remainingSeconds,10)<=60&&(this.$toasted.error("Atenção! Você tem menos de um minuto para realizar o pagamento. Realize o pagamento dentro do tempo limite para garantir suas mesas.",{duration:8e3}),this.shownAlert=!0),void this.$nextTick((()=>{this.$refs.timer?this.$refs.timer.startTimer():window.setTimeout(this.startTimer,1e3)})))},copyCode:async function(){try{let e=document.querySelector("#textToCopy");e.select(),document.execCommand("copy"),this.$toasted.success("Código copiado!")}catch(e){console.error(e),this.$toasted.error("Não foi possível copiar o código")}},startTimer:function(){this.$refs.timer&&this.$refs.timer.startTimer()},atTimerEnd:function(){this.stopPolling(),this.timeout=window.setTimeout(this.getState,1e3)}}},me=ue,he=(0,b.A)(me,ce,de,!1,null,"cbdffaba",null),pe=he.exports,fe=function(){var e=this,t=e._self._c;return t(p.A,{attrs:{fluid:"","fill-height":""}},[e.bookedResources.length?e._e():t("FullscreenLoader"),t(m.A,{staticStyle:{width:"100%"}},[t(h.ri,[e._v(" Compra finalizada ")]),t(h.OQ,[t("p",[e._v(e._s(e.getBookedResourcesText))])]),t(h.SL,[t(l.A),t(C.A,{attrs:{color:"primary"},on:{click:e.buyMore}},[e._v("Comprar mais mesas")])],1)],1)],1)},ge=[],ve={name:"PurchaseFinished",components:{FullscreenLoader:T},data:function(){return{bookedResources:[],headers:[{text:"Nome",value:"nome_recurso"}]}},computed:{getBookedResourcesText:function(){return this.bookedResources.length>1?"Mesas reservadas para você: "+this.bookedResources.map((e=>e.nome_recurso_short)).join(", "):"Mesa reservada para você: "+this.bookedResources.map((e=>e.nome_recurso_short)).join(", ")}},mounted:function(){this.loadBookedResources()},methods:{loadBookedResources:async function(){const e=await this.$axios.post("/resource/booked");e.data.recursos&&e.data.recursos.length?this.bookedResources=e.data.recursos:window.setTimeout(this.loadBookedResources,1e3)},buyMore:function(){this.$emit("restart")}}},_e=ve,Se=(0,b.A)(_e,fe,ge,!1,null,null,null),ye=Se.exports,Ae=function(){var e=this,t=e._self._c;return t(p.A,{attrs:{fluid:"","fill-height":""}},[t(m.A,{staticStyle:{width:"100%"}},[t(h.ri,[e._v(" Tempo expirado! ")]),t(h.OQ,[t("p",[e._v(e._s(e.getMessage))])]),t(h.SL,[t(l.A),t(C.A,{attrs:{color:"primary"},on:{click:e.buyMore}},[e._v("Voltar para comprar mesas")])],1)],1)],1)},be=[],Ee={name:"TimeExpired",data:function(){return{steps:{REGISTER:0,QUEUE:1,SELECTION:2,PAYMENT:3,PAID:4,SELECTION_EXPIRED:5,PAYMENT_EXPIRED:6}}},props:{step:{type:Number,required:!0}},computed:{getMessage:function(){return this.step===this.steps.SELECTION_EXPIRED?"O tempo para escolher as mesas expirou. Você pode clicar no botão abaixo para voltar para a fila novamente.":this.step===this.steps.PAYMENT_EXPIRED?"O tempo para pagamento expirou. Você pode clicar no botão abaixo para voltar para a fila novamente.":null}},methods:{buyMore:function(){this.$emit("restart")}}},Te=Ee,Ce=(0,b.A)(Te,Ae,be,!1,null,null,null),ke=Ce.exports,xe={name:"App",components:{StartWaiting:L,StartForm:G,ResourceList:le,PaymentStep:pe,PurchaseFinished:ye,TimeExpired:ke},data:()=>({steps:{START_WAITING:-1,REGISTER:0,QUEUE:1,SELECTION:2,PAYMENT:3,PAID:4,SELECTION_EXPIRED:5,PAYMENT_EXPIRED:6},step:-1,restart:!1}),methods:{handleGotoStep:function(e){this.step=this.steps[Object.keys(this.steps).find((t=>this.steps[t]===e))]},handleRestart:function(){this.step=this.steps.REGISTER,this.restart=!0}}},Ie=xe,we=(0,b.A)(Ie,d,u,!1,null,null,null),Pe=we.exports,Re=i(5868);a.Ay.use(Re.A);var $e=new Re.A({theme:{themes:{light:{primary:"#000084",secondary:"#e6e998",accent:"#d82621",error:"#d82621",background:"#fafafa"}}}}),De=i(5160),Ne=i.n(De),Le=i(4335);const Oe=Le.A.create({baseURL:"https://leme.ngrok.app",timeout:1e4,headers:{"Content-Type":"application/json"}});Oe.interceptors.request.use((e=>(e.headers["X-User-Uuid"]=localStorage.getItem("uuid_usuario"),e.headers["Authorization"]=localStorage.getItem("token"),e)));var qe=Oe,Me=i(9928),Ve=i.n(Me);a.Ay.config.productionTip=!1,a.Ay.prototype.$axios=qe,a.Ay.use(Ne(),{position:"bottom-center",duration:3e3,theme:"toasted-primary"}),a.Ay.use(Ve()),new a.Ay({vuetify:$e,render:e=>e(Pe)}).$mount("#app")}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,i),o.exports}i.m=e,function(){var e=[];i.O=function(t,a,s,o){if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],o=e[d][2];for(var r=!0,l=0;l<a.length;l++)(!1&o||n>=o)&&Object.keys(i.O).every((function(e){return i.O[e](a[l])}))?a.splice(l--,1):(r=!1,o<n&&(n=o));if(r){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,s,o]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/lemefest/"}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,o,n=a[0],r=a[1],l=a[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(l)var d=l(i)}for(t&&t(a);c<n.length;c++)o=n[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},a=self["webpackChunklemefest"]=self["webpackChunklemefest"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=i.O(void 0,[504],(function(){return i(7818)}));a=i.O(a)})();
//# sourceMappingURL=app.8c64bbbf.js.map